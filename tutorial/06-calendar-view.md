---
ms.openlocfilehash: 65fd8e133174c6ac7bbbbc00487cabc72ebe561d
ms.sourcegitcommit: e0d9b18d2d4cbeb4a48890f3420a47e6a90abc53
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2020
ms.locfileid: "49347925"
---
<!-- markdownlint-disable MD002 MD041 -->

В этом разделе вы будете использовать пакет SDK Microsoft Graph для получения следующих 3 ближайших событий в календаре пользователя за текущую неделю.

## <a name="get-a-calendar-view"></a>Получение представления календаря

Представление календаря — это список событий в календаре пользователя, которые находятся между двумя значениями даты и времени. Преимущество использования представления календаря состоит в том, что оно включает все экземпляры повторяющихся собраний.

1. Откройте **./CardHelper.CS** и добавьте приведенную ниже функцию в класс **кардхелпер** .

    :::code language="csharp" source="../demo/GraphCalendarBot/CardHelper.cs" id="GetEventCardSnippet":::

    Этот код создает адаптивную карточку для отображения события календаря.

1. Откройте **/диалогс/маиндиалог.КС** и добавьте приведенную ниже функцию в класс **маиндиалог** .

    :::code language="csharp" source="../demo/GraphCalendarBot/Dialogs/MainDialog.cs" id="DisplayCalendarViewSnippet":::

    Рассмотрите, что делает этот код.

    - Он получает **MailboxSettings** пользователя, чтобы определить предпочитаемый пользователем часовой пояс и форматы даты и времени.
    - Значения **startDateTime** и **endDateTime** задаются на текущий момент и конец недели соответственно. Этот параметр определяет окно времени, которое используется представлением календаря.
    - Она вызывается `graphClient.Me.CalendarView` со следующими сведениями.
        - Он задает `Prefer: outlook.timezone` для заголовка предпочтительный часовой пояс пользователя, что приводит к тому, что время начала и окончания события будут находиться на часовом поясе пользователя.
        - Он использует `Top(3)` метод, чтобы ограничить результаты только первыми 3 событиями.
        - Он используется `Select` , чтобы ограничить возвращаемые поля только теми полями, которые используются элементом Bot.
        - Он используется `OrderBy` для сортировки событий по времени начала.
    - Добавляет адаптивную карточку для каждого события в ответное сообщение.

1. Замените код внутри `else if (command.StartsWith("show calendar"))` блока на `ProcessStepAsync` приведенный ниже код.

    :::code language="csharp" source="../demo/GraphCalendarBot/Dialogs/MainDialog.cs" id="ShowCalendarSnippet" highlight="3":::

1. Сохраните все изменения и перезапустите Bot.

1. С помощью эмулятора Bot Framework подключитесь к Bot и войдите в систему. Нажмите кнопку **Показать календарь** , чтобы открыть представление календаря.

    ![Снимок экрана: Адаптивная карточка, в которой показаны три следующих события](images/calendar-view.png)
