---
ms.openlocfilehash: 9a320225c7e7e76506d73909a311fa019b1f74f3
ms.sourcegitcommit: e0d9b18d2d4cbeb4a48890f3420a47e6a90abc53
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2020
ms.locfileid: "49347859"
---
<!-- markdownlint-disable MD002 MD041 -->

В этом упражнении вы создадите новую регистрацию каналов Bot и регистрацию веб-приложения Azure AD с помощью портала Azure.

## <a name="create-a-bot-channels-registration"></a>Создание регистрации каналов канала ленты

1. Откройте браузер и перейдите на [портал Azure](https://portal.azure.com). Войдите, используя учетную запись, связанную с вашей подпиской Azure.

1. Выберите меню в левом верхнем углу, а затем выберите команду **создать ресурс**.

    ![Снимок экрана: меню портала Azure](images/create-resource.png)

1. На **новой** странице найдите `Bot Channel` и выберите **Регистрация каналов ленты**.

1. На странице **Регистрация каналов Bot** нажмите кнопку **создать**.

1. Заполните обязательные поля и оставьте поле **Конечная точка обмена сообщениями** пустыми. Поле **маркера Bot** должно быть уникальным. Обязательно изучите различные ценовые категории и выберите, что имеет смысл для вашего сценария. Если это всего лишь учебное упражнение, вы можете выбрать параметр Free (бесплатный).

1. Выберите **идентификатор приложения и пароль**, а затем выберите **создать новый**.

1. Выберите **создать идентификатор приложения на портале регистрации приложений**. Откроется новое окно или вкладка в колонке **регистрации приложений** на портале Azure.

1. В колонке **Регистрация приложений** выберите пункт **создать регистрацию**.

1. Задайте значения следующим образом.

    - Введите **имя** `Graph Calendar Bot`.
    - Введите **поддерживаемые типы учетных записей** для **учетных записей в любом каталоге организаций и личных учетных записей Microsoft**.
    - Оставьте поле **URI перенаправления** пустым.

    ![Снимок страницы "регистрация приложения"](./images/aad-register-an-app.png)

1. Нажмите **Зарегистрировать**. На странице " **робот календарного календаря** " СКОПИРУЙТЕ значение **идентификатора Application (Client)** и сохраните его, он понадобится в следующих шагах.

    ![Снимок экрана с ИДЕНТИФИКАТОРом приложения для новой регистрации приложения](./images/aad-application-id.png)

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание** и выберите один из вариантов **истечения срока действия** , а затем нажмите кнопку **добавить**.

1. Скопируйте значение секрета клиента, а затем покиньте эту страницу. Это потребуется в следующих шагах.

    > [!IMPORTANT]
    > Это секрет клиента, он никогда не отображается еще раз, поэтому убедитесь, что вы скопировали его. Необходимо ввести это значение в несколько мест, чтобы обеспечить безопасность.

1. Вернитесь в окно регистрации канала Bot в браузере и вставьте идентификатор приложения в поле **идентификатор приложения Microsoft** . Вставьте секрет клиента в поле **Password (пароль** ). Нажмите кнопку **ОК**.

1. На странице **Регистрация каналов Боты** нажмите кнопку **создать**.

1. Дождитесь создания регистрации каналов ленты. После создания вернитесь на домашнюю страницу на портале Azure, а затем выберите **службы Bot**. Выберите новую регистрацию канала Боты, чтобы просмотреть ее свойства.

## <a name="create-a-web-app-registration"></a>Создание регистрации веб-приложения

1. Вернитесь к разделу **Регистрация приложений** на портале Azure.

1. Выберите **Новая регистрация**. На странице **Зарегистрировать приложение** задайте необходимые значения следующим образом.

    - Введите **имя** `Graph Calendar Bot Auth`.
    - Введите **поддерживаемые типы учетных записей** для **учетных записей в любом каталоге организаций и личных учетных записей Microsoft**.
    - В разделе **URI адрес перенаправления** введите значение в первом раскрывающемся списке `Web` и задайте значение `https://token.botframework.com/.auth/web/redirect`.

1. Нажмите **Зарегистрировать**. На странице "поэтапная **Проверка подлинности для календаря Graph** " СКОПИРУЙТЕ значение **идентификатора Application (Client)** и сохраните его, он понадобится в следующих шагах.

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание** и выберите один из вариантов **истечения срока действия** , а затем нажмите кнопку **добавить**.

1. Скопируйте значение секрета клиента, а затем покиньте эту страницу. Это потребуется в следующих шагах.

1. Выберите **разрешения API**, а затем нажмите кнопку **Добавить разрешение**.

1. Выберите **Microsoft Graph**, а затем выберите **делегированные разрешения**.

1. Выберите указанные ниже разрешения и нажмите кнопку **Добавить разрешения**.

    - **openid**
    - **profile**
    - **Calendars.ReadWrite**
    - **MailboxSettings.Read**

    ![Снимок экрана с настроенными разрешениями](images/configured-permissions.png)

### <a name="about-permissions"></a>Сведения о разрешениях

Обратите внимание на то, что каждая из этих областей разрешений разрешает ему выполнить, а также о том, для чего они используются в качестве ленты.

- **OpenID** and **Profile**: позволяет botу подписывать пользователей и получать основные сведения из Azure AD в маркере удостоверения.
- **Calendars. ReadWrite**: позволяет элементу Bot читать календарь пользователя и добавлять новые события в календарь пользователя.
- **MailboxSettings. Read**: позволяет роботу читать параметры почтового ящика пользователя. Bot будет использовать этот элемент для получения выбранного пользователем часового пояса.
- **User. Read**: позволяет объекту Bot получить профиль пользователя из Microsoft Graph. Bot будет использовать для получения имени пользователя.

## <a name="add-oauth-connection-to-the-bot"></a>Добавление подключения OAuth к Bot

1. Перейдите на страницу регистрации каналов ленты Bot на портале Azure. Выберите **Параметры** в разделе **Управление Bot**.

1. В разделе **Параметры подключения OAuth** в нижней части страницы нажмите кнопку **Добавить параметр**.

1. Заполните форму следующим образом, а затем нажмите кнопку **сохранить**.

    - **Имя**: `GraphBotAuth`
    - **Поставщик**: **Azure Active Directory v2**
    - **Идентификатор клиента**: идентификатор приложения для регистрации **подлинности Bot** почтового календаря.
    - **Секрет клиента**: Секрет клиента для регистрации **подлинности Bot** почтового календаря.
    - **URL-адрес для обмена маркерами**: оставьте пустым
    - **Идентификатор клиента**: `common`
    - **Области**: `openid profile Calendars.ReadWrite MailboxSettings.Read User.Read`

1. Выберите запись **графботаус** в разделе **Параметры подключения OAuth**.

1. Выберите **проверить подключение**. Откроется новое окно браузера или вкладка для запуска процесса OAuth.

1. При необходимости выполните вход. Просмотрите список запрошенных разрешений, а затем нажмите кнопку **принять**.

1. Должно появиться **тестовое подключение к сообщению "графботаус"** .

> [!TIP]
> Вы можете нажать кнопку **Копировать маркер** на этой странице и вставить маркер в, [https://jwt.ms](https://jwt.ms) чтобы увидеть утверждения внутри маркера. Это полезно при устранении ошибок проверки подлинности.
